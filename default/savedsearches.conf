[splunk014]
action.correlationsearch.enabled = 1
action.correlationsearch.label = splunk014
action.script.param.description = alknckdnfa
action.script.param.rule_name = splunk014
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8
action.socnotable.param.killchain = Execution
action.socnotable.param.mitreattack = T2223
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = alknckdnfa
action.socnotable.param.security_domain = malware
action.socnotable.param.severity = high
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */9 * * * *
description = alknckdnfa
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=_internal\
| stats count by host

[SOC - Brute Force Attack]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Brute Force Attack
action.script.param.description = Multiple failed logins followed by a success
action.script.param.rule_name = SOC - Brute Force Attack
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 6
action.socnotable.param.killchain = Initial Access
action.socnotable.param.mitreattack = T1110
action.socnotable.param.notable_title_field = user
action.socnotable.param.rule_description = Detects brute-force login attempts
action.socnotable.param.security_domain = access
action.socnotable.param.severity = high
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects multiple failed login attempts followed by a success
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=security sourcetype=authentication | transaction user maxspan=5m startswith="failed login" endswith="successful login" | where eventcount > 5 | table _time, user, src_ip, eventcount

[SOC - Suspicious PowerShell Execution]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious PowerShell Execution
action.script.param.description = Detects PowerShell execution with Base64 or IEX commands
action.script.param.rule_name = SOC - Suspicious PowerShell Execution
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8
action.socnotable.param.killchain = Execution
action.socnotable.param.mitreattack = T1059.001
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Detects malicious PowerShell execution
action.socnotable.param.security_domain = malware
action.socnotable.param.severity = high
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects potentially malicious PowerShell execution
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype="WinEventLog:Security" EventCode=4688 | search ProcessName="*powershell.exe*" (CommandLine="*Base64*" OR CommandLine="*IEX*") | table _time, user, ProcessName, CommandLine, src_ip

[SOC - Malware Beaconing Detection]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Malware Beaconing Detection
action.script.param.description = Detects periodic outbound connections to the same destination
action.script.param.rule_name = SOC - Malware Beaconing Detection
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 9
action.socnotable.param.killchain = Command and Control
action.socnotable.param.mitreattack = T1071
action.socnotable.param.notable_title_field = dest_ip
action.socnotable.param.rule_description = Detects malware beaconing patterns
action.socnotable.param.security_domain = network
action.socnotable.param.severity = high
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */20 * * * *
description = Detects hosts making periodic network connections, a sign of malware beaconing
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=network sourcetype=firewall OR sourcetype=proxy | stats count, earliest(_time), latest(_time) by src_ip, dest_ip | where count > 10 AND (latest - earliest) < 600 | table _time, src_ip, dest_ip, count

[SOC - Data Exfiltration Detection]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Data Exfiltration Detection
action.script.param.description = Detects unusual data transfer activities
action.script.param.rule_name = SOC - Data Exfiltration Detection
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 10
action.socnotable.param.killchain = Exfiltration
action.socnotable.param.mitreattack = T1567
action.socnotable.param.notable_title_field = src_ip
action.socnotable.param.rule_description = Identifies data exfiltration attempts
action.socnotable.param.security_domain = network
action.socnotable.param.severity = high
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */30 * * * *
description = Detects unusual data transfer patterns indicative of data exfiltration
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=network sourcetype=firewall OR sourcetype=proxy | stats sum(bytes) as total_bytes by src_ip, dest_ip | where total_bytes > 1000000000 | table _time, src_ip, dest_ip, total_bytes

[SOC - Unauthorized DB Access]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Unauthorized DB Access
action.script.param.description = Detects access to databases from non-standard IPs or hours
action.script.param.rule_name = SOC - Unauthorized DB Access
action.script.param.severity = medium
action.socnotable = 1
action.socnotable.param.cis = CIS 10
action.socnotable.param.killchain = Credential Access
action.socnotable.param.mitreattack = T1557
action.socnotable.param.notable_title_field = user
action.socnotable.param.rule_description = Alerts on database access from unusual sources
action.socnotable.param.security_domain = database
action.socnotable.param.severity = medium
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */30 * * * *
description = Identifies unauthorized database access attempts
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=database sourcetype=db_audit_logs | stats count by user, src_ip, hour | eventstats median(count) as median_count by user | where count > (median_count * 2) | table _time, user, src_ip, count

[SOC - Unauthorized Service Creation]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Unauthorized Service Creation
action.script.param.description = Detects unauthorized service creation
action.script.param.rule_name = SOC - Unauthorized Service Creation
action.script.param.severity = medium
action.socnotable = 1
action.socnotable.param.cis = CIS 10
action.socnotable.param.killchain = Execution
action.socnotable.param.mitreattack = T1059
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Detects unauthorized service creation
action.socnotable.param.security_domain = malware
action.socnotable.param.severity = medium
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */30 * * * *
description = Identifies unauthorized service creation attempts
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4688 | search ProcessName="*services.exe*" | stats count by user, ProcessName, src_ip | where count > 10 | table _time, user, ProcessName, src_ip, count

[SOC - Unauthorized File Access]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Unauthorized File Access
action.script.param.description = Detects unauthorized file access
action.script.param.rule_name = SOC - Unauthorized File Access
action.script.param.severity = medium
action.socnotable = 1
action.socnotable.param.cis = CIS 10
action.socnotable.param.killchain = Credential Access
action.socnotable.param.mitreattack = T1557
action.socnotable.param.notable_title_field = user
action.socnotable.param.rule_description = Detects unauthorized file access
action.socnotable.param.security_domain = malware
action.socnotable.param.severity = medium
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */30 * * * *
description = Identifies unauthorized file access attempts
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4688 | search ProcessName="*explorer.exe*" | stats count by user, ProcessName, src_ip | where count > 10 | table _time, user, ProcessName, src_ip, count

[SOC - Privilege Escalation Detection]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Privilege Escalation Detection
action.script.param.description = Detects sudden privilege escalation activities
action.script.param.rule_name = SOC - Privilege Escalation Detection
action.script.param.severity = critical
action.socnotable = 1
action.socnotable.param.cis = CIS 5.1
action.socnotable.param.killchain = Privilege Escalation
action.socnotable.param.mitreattack = T1548
action.socnotable.param.notable_title_field = user
action.socnotable.param.rule_description = Detects unauthorized privilege escalation attempts
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = critical
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */5 * * * *
description = Identifies unauthorized privilege escalation attempts
disabled = 1
dispatch.earliest_time = -1h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security (EventCode=4672 OR EventCode=4732) | stats count by user, ComputerName, EventCode | where count > 3 | table _time, user, ComputerName, EventCode, count

[SOC - Ransomware File Activity]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Ransomware File Activity
action.script.param.description = Detects mass file modifications typical of ransomware
action.script.param.rule_name = SOC - Ransomware File Activity
action.script.param.severity = critical
action.socnotable = 1
action.socnotable.param.cis = CIS 8.2
action.socnotable.param.killchain = Impact
action.socnotable.param.mitreattack = T1486
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies potential ransomware activity
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = critical
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects rapid file modifications indicative of ransomware
disabled = 1
dispatch.earliest_time = -10m
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=FileSystemAudit | stats count by host, user, file_extension | where count > 100 | table _time, host, user, file_extension, count

[SOC - Lateral Movement Detection]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Lateral Movement Detection
action.script.param.description = Detects potential lateral movement across network
action.script.param.rule_name = SOC - Lateral Movement Detection
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 16.4
action.socnotable.param.killchain = Lateral Movement
action.socnotable.param.mitreattack = T1021
action.socnotable.param.notable_title_field = src_host
action.socnotable.param.rule_description = Identifies potential lateral movement attempts
action.socnotable.param.security_domain = network
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects potential lateral movement across network by monitoring for hosts connecting to multiple destinations
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=network sourcetype=firewall | stats dc(dest_ip) as unique_destinations by src_ip, src_host | where unique_destinations > 20 | table _time, src_ip, src_host, unique_destinations

[SOC - Pass-the-Hash Detection]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Pass-the-Hash Detection
action.script.param.description = Detects potential Pass-the-Hash attacks
action.script.param.rule_name = SOC - Pass-the-Hash Detection
action.script.param.severity = critical
action.socnotable = 1
action.socnotable.param.cis = CIS 16.13
action.socnotable.param.killchain = Lateral Movement
action.socnotable.param.mitreattack = T1550.002
action.socnotable.param.notable_title_field = user
action.socnotable.param.rule_description = Identifies Pass-the-Hash attack patterns
action.socnotable.param.security_domain = access
action.socnotable.param.severity = critical
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */5 * * * *
description = Detects potential Pass-the-Hash attacks by monitoring for suspicious NTLM authentication patterns
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4624 | where LogonType=3 AND AuthenticationPackageName="NTLM" | stats count by src_ip, user, host | where count > 3 | table _time, src_ip, user, host, count

[SOC - Golden Ticket Detection]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Golden Ticket Detection
action.script.param.description = Detects potential Kerberos Golden Ticket attacks
action.script.param.rule_name = SOC - Golden Ticket Detection
action.script.param.severity = critical
action.socnotable = 1
action.socnotable.param.cis = CIS 16.13
action.socnotable.param.killchain = Credential Access
action.socnotable.param.mitreattack = T1558.001
action.socnotable.param.notable_title_field = user
action.socnotable.param.rule_description = Identifies Golden Ticket usage
action.socnotable.param.security_domain = access
action.socnotable.param.severity = critical
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */5 * * * *
description = Detects potential Kerberos Golden Ticket attacks by monitoring for suspicious ticket granting patterns
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security (EventCode=4768 OR EventCode=4769) | stats values(ServiceName) as services by user | where len(services) > 10 | table _time, user, services

[SOC - Suspicious LSASS Access]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious LSASS Access
action.script.param.description = Detects suspicious access to LSASS process for potential credential dumping activities
action.script.param.rule_name = SOC - Suspicious LSASS Access
action.script.param.severity = critical
action.socnotable = 1
action.socnotable.param.cis = CIS 16.13
action.socnotable.param.killchain = Credential Access
action.socnotable.param.mitreattack = T1003.001
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies potential credential dumping from LSASS
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = critical
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */5 * * * *
description = Detects suspicious access to LSASS process for potential credential dumping activities
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=Sysmon EventCode=10 | search TargetImage="*lsass.exe" | stats count by host, SourceImage, TargetImage | table _time, host, SourceImage, TargetImage, count

[SOC - Remote Desktop Brute Force]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Remote Desktop Brute Force
action.script.param.description = Detects RDP brute force attempts
action.script.param.rule_name = SOC - Remote Desktop Brute Force
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 16.13
action.socnotable.param.killchain = Initial Access
action.socnotable.param.mitreattack = T1110
action.socnotable.param.notable_title_field = src_ip
action.socnotable.param.rule_description = Identifies RDP brute force attacks
action.socnotable.param.security_domain = access
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */5 * * * *
description = Detects RDP brute force attempts by monitoring failed login patterns
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4625 | search LogonType=10 | stats count by src_ip, targeted_user | where count > 10 | table _time, src_ip, targeted_user, count

[SOC - WMI Persistence]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - WMI Persistence
action.script.param.description = Detects WMI persistence mechanisms used for maintaining unauthorized access
action.script.param.rule_name = SOC - WMI Persistence
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.1
action.socnotable.param.killchain = Persistence
action.socnotable.param.mitreattack = T1546.003
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies WMI persistence attempts
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects WMI persistence mechanisms used for maintaining unauthorized access
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Microsoft-Windows-WMI-Activity/Operational EventCode=5861 | stats count by host, user, Consumer, Query | table _time, host, user, Consumer, Query, count

[SOC - Active Directory Replication Abuse]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Active Directory Replication Abuse
action.script.param.description = Detects potential abuse of AD replication mechanisms
action.script.param.rule_name = SOC - Active Directory Replication Abuse
action.script.param.severity = critical
action.socnotable = 1
action.socnotable.param.cis = CIS 16.2
action.socnotable.param.killchain = Credential Access
action.socnotable.param.mitreattack = T1003.006
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies potential DCSync and DCShadow attacks
action.socnotable.param.security_domain = access
action.socnotable.param.severity = critical
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */5 * * * *
description = Detects potential Active Directory replication abuse through monitoring of replication requests and patterns
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security (EventCode=4662 OR EventCode=5136) | search "Replication-Get" OR "DS-Replication" | stats count by host, user, ObjectName, AccessMask | where count > 2 | table _time, host, user, ObjectName, AccessMask, count

[SOC - DPAPI Master Key Extraction]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - DPAPI Master Key Extraction
action.script.param.description = Detects attempts to extract DPAPI master keys
action.script.param.rule_name = SOC - DPAPI Master Key Extraction
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 16.13
action.socnotable.param.killchain = Credential Access
action.socnotable.param.mitreattack = T1003.004
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies potential DPAPI master key theft
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects attempts to access or extract DPAPI master keys which could indicate credential theft
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4656 | search ObjectName="*Microsoft\Protect\S-1-5*" | stats count by host, user, ObjectName, ProcessName | table _time, host, user, ObjectName, ProcessName, count

[SOC - Windows Defender Tampering]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Windows Defender Tampering
action.script.param.description = Detects attempts to disable or modify Windows Defender
action.script.param.rule_name = SOC - Windows Defender Tampering
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.1
action.socnotable.param.killchain = Defense Evasion
action.socnotable.param.mitreattack = T1562.001
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies attempts to disable security tools
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */5 * * * *
description = Detects attempts to disable or modify Windows Defender settings and services
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows (sourcetype=WinEventLog:Microsoft-Windows-Windows Defender* OR sourcetype=WinEventLog:System) | search (EventCode=5007 OR EventCode=5001 OR EventCode=7036) | search "Windows Defender" "stopped" OR "disabled" OR "TamperProtection" | stats count by host, user, EventCode, Message | table _time, host, user, EventCode, Message, count

[SOC - PowerShell Script Block Logging Disabled]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - PowerShell Script Block Logging Disabled
action.script.param.description = Detects disabling of PowerShell Script Block logging
action.script.param.rule_name = SOC - PowerShell Script Block Logging Disabled
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.5
action.socnotable.param.killchain = Defense Evasion
action.socnotable.param.mitreattack = T1562.002
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies attempts to disable PowerShell logging
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects attempts to disable PowerShell Script Block logging which could indicate evasion
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Microsoft-Windows-PowerShell/Operational EventCode=4104 | regex Message=".*Set-PSReadlineOption.*HistorySaveStyle.*SaveNothing.*|.*Set-ItemProperty.*ScriptBlockLogging.*EnableScriptBlockLogging.*0.*" | stats count by host, user, Message | table _time, host, user, Message, count

[SOC - Suspicious LDAP Queries]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious LDAP Queries
action.script.param.description = Detects suspicious LDAP reconnaissance activities
action.script.param.rule_name = SOC - Suspicious LDAP Queries
action.script.param.severity = medium
action.socnotable = 1
action.socnotable.param.cis = CIS 16.4
action.socnotable.param.killchain = Discovery
action.socnotable.param.mitreattack = T1087
action.socnotable.param.notable_title_field = src_ip
action.socnotable.param.rule_description = Identifies potential AD enumeration attempts
action.socnotable.param.security_domain = access
action.socnotable.param.severity = medium
alert.severity = 3
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects suspicious LDAP queries that may indicate Active Directory enumeration attempts
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4662 | search "LDAP" ObjectType="*" | stats count dc(ObjectName) as unique_objects by src_ip, user | where count > 100 OR unique_objects > 50 | table _time, src_ip, user, count, unique_objects

[SOC - Windows Time Service Manipulation]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Windows Time Service Manipulation
action.script.param.description = Detects manipulation of Windows Time service
action.script.param.rule_name = SOC - Windows Time Service Manipulation
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.1
action.socnotable.param.killchain = Defense Evasion
action.socnotable.param.mitreattack = T1070.006
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies attempts to manipulate system time
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects attempts to manipulate Windows Time service which could indicate timestamp manipulation
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:System EventCode=4616 OR (EventCode=7040 AND "Windows Time") | stats count by host, user, Message | table _time, host, user, Message, count

[SOC - Suspicious Registry Run Keys]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Registry Run Keys
action.script.param.description = Detects modifications to autorun registry keys
action.script.param.rule_name = SOC - Suspicious Registry Run Keys
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.4
action.socnotable.param.killchain = Persistence
action.socnotable.param.mitreattack = T1547.001
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious registry persistence
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects modifications to Windows registry run keys which could indicate persistence mechanisms
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4657 | regex TargetObject=".*(\\Software\\Microsoft\\Windows\\CurrentVersion\\Run|\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce).*" | stats count by host, user, TargetObject, NewValue | table _time, host, user, TargetObject, NewValue, count

[SOC - Suspicious Service Account Creation]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Service Account Creation
action.script.param.description = Detects creation of new service accounts
action.script.param.rule_name = SOC - Suspicious Service Account Creation
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 16.9
action.socnotable.param.killchain = Persistence
action.socnotable.param.mitreattack = T1136.001
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious service account creation
action.socnotable.param.security_domain = access
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects creation of new service accounts which could indicate privilege escalation attempts
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4720 | regex AccountName=".*(service|svc).*" | stats count by host, user, AccountName, SamAccountName | table _time, host, user, AccountName, SamAccountName, count

[SOC - Suspicious Network Share Access]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Network Share Access
action.script.param.description = Detects suspicious access to network shares
action.script.param.rule_name = SOC - Suspicious Network Share Access
action.script.param.severity = medium
action.socnotable = 1
action.socnotable.param.cis = CIS 9.2
action.socnotable.param.killchain = Lateral Movement
action.socnotable.param.mitreattack = T1021.002
action.socnotable.param.notable_title_field = src_ip
action.socnotable.param.rule_description = Identifies suspicious network share access
action.socnotable.param.security_domain = network
action.socnotable.param.severity = medium
alert.severity = 3
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects suspicious access patterns to network shares which could indicate data exfiltration
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=5140 | stats count dc(ShareName) as unique_shares by src_ip, user | where count > 50 OR unique_shares > 10 | table _time, src_ip, user, count, unique_shares

[SOC - Suspicious PowerShell Download]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious PowerShell Download
action.script.param.description = Detects suspicious PowerShell download activities
action.script.param.rule_name = SOC - Suspicious PowerShell Download
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.5
action.socnotable.param.killchain = Command and Control
action.socnotable.param.mitreattack = T1059.001
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious PowerShell downloads
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects suspicious PowerShell download activities which could indicate malicious payload delivery
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Microsoft-Windows-PowerShell/Operational EventCode=4104 | regex ScriptBlockText=".*(Invoke-WebRequest|wget|curl|Net.WebClient|DownloadFile|DownloadString).*" | stats count by host, user, ScriptBlockText | table _time, host, user, ScriptBlockText, count

[SOC - Suspicious DLL Loading]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious DLL Loading
action.script.param.description = Detects suspicious DLL loading patterns
action.script.param.rule_name = SOC - Suspicious DLL Loading
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.1
action.socnotable.param.killchain = Defense Evasion
action.socnotable.param.mitreattack = T1574
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious DLL loading activities
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects suspicious DLL loading patterns which could indicate DLL hijacking or injection
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=7040 OR sourcetype=Sysmon EventCode=7 | regex ImageLoaded=".*(temp|appdata|downloads).*\.dll" | stats count by host, user, Image, ImageLoaded | table _time, host, user, Image, ImageLoaded, count

[SOC - Suspicious Process Creation Chain]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Process Creation Chain
action.script.param.description = Detects suspicious process creation patterns
action.script.param.rule_name = SOC - Suspicious Process Creation Chain
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.1
action.socnotable.param.killchain = Execution
action.socnotable.param.mitreattack = T1059
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious process chains
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects suspicious process creation chains that could indicate malicious activity
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4688 | transaction ParentProcessId maxspan=1m | where len(ProcessName) > 3 | stats count by host, user, ProcessName, ParentProcessName | table _time, host, user, ProcessName, ParentProcessName, count

[SOC - Suspicious File Creation]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious File Creation
action.script.param.description = Detects suspicious file creation patterns
action.script.param.rule_name = SOC - Suspicious File Creation
action.script.param.severity = medium
action.socnotable = 1
action.socnotable.param.cis = CIS 8.2
action.socnotable.param.killchain = Execution
action.socnotable.param.mitreattack = T1059
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious file creation
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = medium
alert.severity = 3
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects suspicious file creation patterns that could indicate malicious activity
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4663 | regex ObjectName=".*(\.exe|\.dll|\.ps1|\.vbs|\.bat)$" | stats count by host, user, ObjectName, ProcessName | table _time, host, user, ObjectName, ProcessName, count

[SOC - Suspicious Registry Modification]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Registry Modification
action.script.param.description = Detects suspicious registry modifications
action.script.param.rule_name = SOC - Suspicious Registry Modification
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.4
action.socnotable.param.killchain = Defense Evasion
action.socnotable.param.mitreattack = T1112
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious registry changes
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects suspicious registry modifications that could indicate persistence or evasion
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4657 | regex TargetObject=".*(CurrentControlSet\\Services|SecurityProviders|CurrentVersion\\Run).*" | stats count by host, user, TargetObject, NewValue | table _time, host, user, TargetObject, NewValue, count

[SOC - Suspicious Network Connection]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Network Connection
action.script.param.description = Detects suspicious network connections
action.script.param.rule_name = SOC - Suspicious Network Connection
action.script.param.severity = medium
action.socnotable = 1
action.socnotable.param.cis = CIS 9.2
action.socnotable.param.killchain = Command and Control
action.socnotable.param.mitreattack = T1071
action.socnotable.param.notable_title_field = src_ip
action.socnotable.param.rule_description = Identifies suspicious network activity
action.socnotable.param.security_domain = network
action.socnotable.param.severity = medium
alert.severity = 3
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects suspicious network connections that could indicate command and control activity
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=network sourcetype=firewall | stats count values(dest_port) as ports by src_ip, dest_ip | where count > 100 AND len(ports) < 3 | table _time, src_ip, dest_ip, ports, count

[SOC - Suspicious Account Behavior]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Account Behavior
action.script.param.description = Detects suspicious account activities
action.script.param.rule_name = SOC - Suspicious Account Behavior
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 16.13
action.socnotable.param.killchain = Initial Access
action.socnotable.param.mitreattack = T1078
action.socnotable.param.notable_title_field = user
action.socnotable.param.rule_description = Identifies suspicious account behavior
action.socnotable.param.security_domain = access
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects suspicious account activities that could indicate account compromise
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security (EventCode=4624 OR EventCode=4625) | stats count values(LogonType) as logon_types by user, src_ip | where count > 50 AND len(logon_types) > 3 | table _time, user, src_ip, logon_types, count

[SOC - Suspicious PowerShell Profile Modification]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious PowerShell Profile Modification
action.script.param.description = Detects modifications to PowerShell profiles
action.script.param.rule_name = SOC - Suspicious PowerShell Profile Modification
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.5
action.socnotable.param.killchain = Persistence
action.socnotable.param.mitreattack = T1546.013
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies PowerShell profile tampering
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */15 * * * *
description = Detects modifications to PowerShell profiles which could indicate persistence
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=4663 | regex ObjectName=".*\\WindowsPowerShell\\.*profile\.ps1" | stats count by host, user, ObjectName, ProcessName | table _time, host, user, ObjectName, ProcessName, count

[SOC - Suspicious Task Scheduler Activity]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Task Scheduler Activity
action.script.param.description = Detects suspicious scheduled task activities
action.script.param.rule_name = SOC - Suspicious Task Scheduler Activity
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.2
action.socnotable.param.killchain = Persistence
action.socnotable.param.mitreattack = T1053.005
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious scheduled tasks
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects suspicious scheduled task activities that could indicate persistence
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security (EventCode=4698 OR EventCode=4699 OR EventCode=4700 OR EventCode=4701) | stats count by host, user, TaskName, TaskContent | table _time, host, user, TaskName, TaskContent, count

[SOC - Suspicious Service Installation]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Service Installation
action.script.param.description = Detects suspicious service installations
action.script.param.rule_name = SOC - Suspicious Service Installation
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 8.4
action.socnotable.param.killchain = Persistence
action.socnotable.param.mitreattack = T1543.003
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious service installations
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects suspicious service installations that could indicate persistence
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:System EventCode=7045 | regex ServiceName=".*(admin|remote|RAT|backdoor).*" | stats count by host, user, ServiceName, ImagePath | table _time, host, user, ServiceName, ImagePath, count

[SOC - Suspicious Group Policy Modification]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious Group Policy Modification
action.script.param.description = Detects suspicious Group Policy modifications
action.script.param.rule_name = SOC - Suspicious Group Policy Modification
action.script.param.severity = critical
action.socnotable = 1
action.socnotable.param.cis = CIS 5.1
action.socnotable.param.killchain = Defense Evasion
action.socnotable.param.mitreattack = T1484
action.socnotable.param.notable_title_field = host
action.socnotable.param.rule_description = Identifies suspicious GPO changes
action.socnotable.param.security_domain = endpoint
action.socnotable.param.severity = critical
alert.severity = 5
alert.suppress = 0
alert.track = 1
cron_schedule = */5 * * * *
description = Detects suspicious Group Policy modifications that could indicate privilege escalation
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=windows sourcetype=WinEventLog:Security EventCode=5136 | search "CN=Policies,CN=System" | stats count by host, user, ObjectDN, AttributeLDAPDisplayName | table _time, host, user, ObjectDN, AttributeLDAPDisplayName, count

[SOC - Suspicious DNS Query Pattern]
action.correlationsearch.enabled = 1
action.correlationsearch.label = SOC - Suspicious DNS Query Pattern
action.script.param.description = Detects suspicious DNS query patterns
action.script.param.rule_name = SOC - Suspicious DNS Query Pattern
action.script.param.severity = high
action.socnotable = 1
action.socnotable.param.cis = CIS 9.2
action.socnotable.param.killchain = Command and Control
action.socnotable.param.mitreattack = T1071.004
action.socnotable.param.notable_title_field = src_ip
action.socnotable.param.rule_description = Identifies potential DNS tunneling
action.socnotable.param.security_domain = network
action.socnotable.param.severity = high
alert.severity = 4
alert.suppress = 0
alert.track = 1
cron_schedule = */10 * * * *
description = Detects suspicious DNS query patterns that could indicate DNS tunneling
disabled = 1
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
search = index=network sourcetype=dns | eval query_length=len(query) | stats count avg(query_length) as avg_length by src_ip | where count > 1000 AND avg_length > 50 | table _time, src_ip, count, avg_length
